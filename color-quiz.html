<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Thai Color Quiz</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="color-quiz">
  <h1>Thai Color Quiz</h1>
  <div class="subtitle">Choose the correct phonetic for the Thai color</div>
  <div id="symbol" role="text" aria-label="Thai color phrase">?</div>
  <div class="options" id="options" role="group" aria-label="Answer options"></div>
  <div id="feedback" role="status" aria-live="polite"></div>
  <button id="nextBtn" aria-label="Next question">Next</button>
  <div class="stats" id="stats"></div>
  <div class="footer">
    <a href="index.html" class="back-btn">← Back to Home</a>
  </div>

  <script src="quiz.js"></script>
  <script>
    const baseColors = JSON.parse(`[
      {"english":"white","thai":"สีขาว","phonetic":"sǐi khǎaw","hex":"#ecf0f1"},
      {"english":"black","thai":"สีดำ","phonetic":"sǐi dam","hex":"#2d3436"},
      {"english":"red","thai":"สีแดง","phonetic":"sǐi dɛɛŋ","hex":"#e74c3c"},
      {"english":"yellow","thai":"สีเหลือง","phonetic":"sǐi lɯ̌aŋ","hex":"#f1c40f"},
      {"english":"green","thai":"สีเขียว","phonetic":"sǐi khǐaw","hex":"#2ecc71"},
      {"english":"sky blue","thai":"สีฟ้า","phonetic":"sǐi fáa","hex":"#3498db"},
      {"english":"dark blue","thai":"สีน้ำเงิน","phonetic":"sǐi náam-ŋəən","hex":"#2c3e50"},
      {"english":"orange","thai":"สีส้ม","phonetic":"sǐi sôm","hex":"#e67e22"},
      {"english":"pink","thai":"สีชมพู","phonetic":"sǐi chom-phuu","hex":"#e91e63"},
      {"english":"purple","thai":"สีม่วง","phonetic":"sǐi mûaŋ","hex":"#8e44ad"},
      {"english":"brown","thai":"สีน้ำตาล","phonetic":"sǐi náam-dtaan","hex":"#8d6e63"},
      {"english":"gray","thai":"สีเทา","phonetic":"sǐi thaw","hex":"#95a5a6"}
    ]`);

    const modifiers = JSON.parse(`[
      {"english":"light","thai":"อ่อน","phonetic":"ɔ̀ɔn"},
      {"english":"dark","thai":"เข้ม","phonetic":"khêm"}
    ]`);

    function hexToRgb(hex) {
      const h = hex.replace('#', '');
      const bigint = parseInt(h, 16);
      return { r: (bigint >> 16) & 255, g: (bigint >> 8) & 255, b: bigint & 255 };
    }
    function rgbToHex(r, g, b) {
      const toHex = (x) => x.toString(16).padStart(2, '0');
      return `#${toHex(Math.max(0, Math.min(255, Math.round(r))))}${toHex(Math.max(0, Math.min(255, Math.round(g))))}${toHex(Math.max(0, Math.min(255, Math.round(b))))}`;
    }
    function rgbToHsl(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      const max = Math.max(r, g, b), min = Math.min(r, g, b);
      let h, s, l = (max + min) / 2;
      if (max === min) { h = s = 0; }
      else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = (g - b) / d + (g < b ? 6 : 0); break;
          case g: h = (b - r) / d + 2; break;
          case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
      }
      return { h, s, l };
    }
    function hslToRgb(h, s, l) {
      let r, g, b;
      if (s === 0) { r = g = b = l; }
      else {
        const hue2rgb = (p, q, t) => {
          if (t < 0) t += 1;
          if (t > 1) t -= 1;
          if (t < 1/6) return p + (q - p) * 6 * t;
          if (t < 1/2) return q;
          if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
          return p;
        };
        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        const p = 2 * l - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);
      }
      return { r: r * 255, g: g * 255, b: b * 255 };
    }
    function adjustLightness(hex, delta) {
      const { r, g, b } = hexToRgb(hex);
      const { h, s, l } = rgbToHsl(r, g, b);
      const newL = Math.max(0, Math.min(1, l + delta));
      const { r: nr, g: ng, b: nb } = hslToRgb(h, s, newL);
      return rgbToHex(nr, ng, nb);
    }
    function getDisplayHex(baseHex, modifier) {
      if (!modifier) return baseHex;
      if (/^light$/i.test(modifier.english)) return adjustLightness(baseHex, 0.25);
      if (/^dark$/i.test(modifier.english)) return adjustLightness(baseHex, -0.25);
      return baseHex;
    }
    function buildColorPhrase(base, maybeModifier) {
      const hasBuiltInShade = /(^|\s)(dark|light)\s/i.test(base.english);
      const useModifier = !!maybeModifier && !hasBuiltInShade;
      const thai = useModifier ? `${base.thai} ${maybeModifier.thai}` : base.thai;
      const phonetic = useModifier ? `${base.phonetic} ${maybeModifier.phonetic}` : base.phonetic;
      const english = useModifier ? `${maybeModifier.english} ${base.english}` : base.english;
      const hex = useModifier ? getDisplayHex(base.hex, maybeModifier) : base.hex;
      return { english, thai, phonetic, hex };
    }

    ThaiQuiz.setupQuiz({
      elements: { symbol: 'symbol', options: 'options', feedback: 'feedback', nextBtn: 'nextBtn', stats: 'stats' },
      pickRound: () => {
        const base = baseColors[Math.floor(Math.random() * baseColors.length)];
        const maybeModifier = Math.random() < 0.55 ? modifiers[Math.floor(Math.random() * modifiers.length)] : null;
        const answer = buildColorPhrase(base, maybeModifier);
        const choices = [answer];
        while (choices.length < 4) {
          const b = baseColors[Math.floor(Math.random() * baseColors.length)];
          const m = Math.random() < 0.45 ? modifiers[Math.floor(Math.random() * modifiers.length)] : null;
          const choice = buildColorPhrase(b, m);
          if (!choices.find(c => c.phonetic === choice.phonetic)) choices.push(choice);
        }
        return { answer, choices, symbolText: answer.thai, symbolStyle: { color: answer.hex }, symbolAriaLabel: `Thai color phrase: ${answer.thai}` };
      },
      renderButtonContent: (choice) => choice.phonetic,
      ariaLabelForChoice: (choice) => `Answer: ${choice.phonetic}`,
      isCorrect: (choice, answer) => choice.phonetic === answer.phonetic
    });
  </script>
</body>
</html>
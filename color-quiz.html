<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Thai Color Quiz</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      text-align: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 2em;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      color: white;
    }
    h1 {
      color: white;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      margin-bottom: 0.2em;
    }
    .subtitle {
      opacity: 0.9;
      margin-bottom: 0.8em;
    }
    #symbol {
      font-size: 4.5em;
      margin: 0.6em 0 0.6em 0;
      font-weight: 800;
      color: white;
      text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
      line-height: 1.2;
    }
    .options {
      display: flex;
      flex-direction: column;
      gap: 1em;
      max-width: 500px;
      margin: 0 auto;
    }
    button {
      padding: 1em;
      font-size: 1.2em;
      cursor: pointer;
      border: 2px solid rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border-radius: 15px;
      transition: all 0.3s ease;
      font-weight: 500;
      backdrop-filter: blur(10px);
    }
    button:hover {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    button:active {
      transform: translateY(0);
    }
    #feedback {
      margin-top: 1em;
      font-size: 1.3em;
      font-weight: bold;
      min-height: 1.5em;
      color: white;
    }
    #nextBtn {
      margin-top: 2em;
      padding: 0.8em 2em;
      font-size: 1.1em;
      display: none;
      background: linear-gradient(45deg, #27ae60, #2ecc71);
      color: white;
      border: none;
      border-radius: 15px;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    #nextBtn:hover {
      background: linear-gradient(45deg, #229954, #27ae60);
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    .stats {
      margin-top: 2em;
      font-size: 0.9em;
      color: rgba(255, 255, 255, 0.8);
    }
    .footer {
      margin-top: 2em;
      text-align: center;
    }
    .back-btn {
      color: white;
      text-decoration: none;
      padding: 0.8em 1.5em;
      border-radius: 25px;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
      font-size: 1em;
      font-weight: 500;
      backdrop-filter: blur(10px);
      display: inline-block;
    }
    .back-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    @media (max-width: 600px) {
      body { padding: 0.8em; }
      #symbol { font-size: 3.4em; }
      button { font-size: 1.05em; padding: 0.8em; }
    }
  </style>
</head>
<body>
  <h1>Thai Color Quiz</h1>
  <div class="subtitle">Choose the correct phonetic for the Thai color</div>
  <div id="symbol" role="text" aria-label="Thai color phrase">?</div>
  <div class="options" id="options" role="group" aria-label="Answer options"></div>
  <div id="feedback" role="status" aria-live="polite"></div>
  <button id="nextBtn" aria-label="Next question">Next</button>
  <div class="stats" id="stats"></div>
  <div class="footer">
    <a href="index.html" class="back-btn">← Back to Home</a>
  </div>

  <script>
    const baseColors = JSON.parse(`[
      {"english":"white","thai":"สีขาว","phonetic":"sǐi khǎaw","hex":"#ecf0f1"},
      {"english":"black","thai":"สีดำ","phonetic":"sǐi dam","hex":"#2d3436"},
      {"english":"red","thai":"สีแดง","phonetic":"sǐi dɛɛŋ","hex":"#e74c3c"},
      {"english":"yellow","thai":"สีเหลือง","phonetic":"sǐi lɯ̌aŋ","hex":"#f1c40f"},
      {"english":"green","thai":"สีเขียว","phonetic":"sǐi khǐaw","hex":"#2ecc71"},
      {"english":"sky blue","thai":"สีฟ้า","phonetic":"sǐi fáa","hex":"#3498db"},
      {"english":"dark blue","thai":"สีน้ำเงิน","phonetic":"sǐi náam-ŋəən","hex":"#2c3e50"},
      {"english":"orange","thai":"สีส้ม","phonetic":"sǐi sôm","hex":"#e67e22"},
      {"english":"pink","thai":"สีชมพู","phonetic":"sǐi chom-phuu","hex":"#e91e63"},
      {"english":"purple","thai":"สีม่วง","phonetic":"sǐi mûaŋ","hex":"#8e44ad"},
      {"english":"brown","thai":"สีน้ำตาล","phonetic":"sǐi náam-dtaan","hex":"#8d6e63"},
      {"english":"gray","thai":"สีเทา","phonetic":"sǐi thaw","hex":"#95a5a6"}
    ]`);

    const modifiers = JSON.parse(`[
      {"english":"light","thai":"อ่อน","phonetic":"ɔ̀ɔn"},
      {"english":"dark","thai":"เข้ม","phonetic":"khêm"}
    ]`);

    const symbolEl = document.getElementById('symbol');
    const optionsEl = document.getElementById('options');
    const feedbackEl = document.getElementById('feedback');
    const nextBtn = document.getElementById('nextBtn');
    const statsEl = document.getElementById('stats');

    let currentAnswer = null;
    let questionsAnswered = 0;
    let correctAnswers = 0;

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function updateStats() {
      const accuracy = questionsAnswered > 0 ? Math.round((correctAnswers / questionsAnswered) * 100) : 0;
      statsEl.textContent = `Questions: ${questionsAnswered} | Correct: ${correctAnswers} | Accuracy: ${accuracy}%`;
    }

    // Color utilities to lighten/darken based on modifier
    function hexToRgb(hex) {
      const h = hex.replace('#', '');
      const bigint = parseInt(h, 16);
      return {
        r: (bigint >> 16) & 255,
        g: (bigint >> 8) & 255,
        b: bigint & 255
      };
    }

    function rgbToHex(r, g, b) {
      const toHex = (x) => x.toString(16).padStart(2, '0');
      return `#${toHex(Math.max(0, Math.min(255, Math.round(r))))}${toHex(Math.max(0, Math.min(255, Math.round(g))))}${toHex(Math.max(0, Math.min(255, Math.round(b))))}`;
    }

    function rgbToHsl(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      const max = Math.max(r, g, b), min = Math.min(r, g, b);
      let h, s, l = (max + min) / 2;
      if (max === min) { h = s = 0; }
      else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = (g - b) / d + (g < b ? 6 : 0); break;
          case g: h = (b - r) / d + 2; break;
          case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
      }
      return { h, s, l };
    }

    function hslToRgb(h, s, l) {
      let r, g, b;
      if (s === 0) { r = g = b = l; }
      else {
        const hue2rgb = (p, q, t) => {
          if (t < 0) t += 1;
          if (t > 1) t -= 1;
          if (t < 1/6) return p + (q - p) * 6 * t;
          if (t < 1/2) return q;
          if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
          return p;
        };
        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        const p = 2 * l - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);
      }
      return { r: r * 255, g: g * 255, b: b * 255 };
    }

    function adjustLightness(hex, delta) {
      const { r, g, b } = hexToRgb(hex);
      const { h, s, l } = rgbToHsl(r, g, b);
      const newL = Math.max(0, Math.min(1, l + delta));
      const { r: nr, g: ng, b: nb } = hslToRgb(h, s, newL);
      return rgbToHex(nr, ng, nb);
    }

    function getDisplayHex(baseHex, modifier) {
      if (!modifier) return baseHex;
      if (/^light$/i.test(modifier.english)) return adjustLightness(baseHex, 0.25);
      if (/^dark$/i.test(modifier.english)) return adjustLightness(baseHex, -0.25);
      return baseHex;
    }

    function buildColorPhrase(base, maybeModifier) {
      const hasBuiltInShade = /(^|\s)(dark|light)\s/i.test(base.english);
      const useModifier = !!maybeModifier && !hasBuiltInShade;
      const thai = useModifier ? `${base.thai} ${maybeModifier.thai}` : base.thai;
      const phonetic = useModifier ? `${base.phonetic} ${maybeModifier.phonetic}` : base.phonetic;
      const english = useModifier ? `${maybeModifier.english} ${base.english}` : base.english;
      const hex = useModifier ? getDisplayHex(base.hex, maybeModifier) : base.hex;
      return { english, thai, phonetic, hex };
    }

    function pickQuestion() {
      feedbackEl.textContent = "";
      nextBtn.style.display = "none";
      optionsEl.innerHTML = "";

      const base = baseColors[Math.floor(Math.random() * baseColors.length)];
      const maybeModifier = Math.random() < 0.55 ? modifiers[Math.floor(Math.random() * modifiers.length)] : null;
      const answer = buildColorPhrase(base, maybeModifier);
      currentAnswer = answer;

      const choices = [answer];
      while (choices.length < 4) {
        const b = baseColors[Math.floor(Math.random() * baseColors.length)];
        const m = Math.random() < 0.45 ? modifiers[Math.floor(Math.random() * modifiers.length)] : null;
        const choice = buildColorPhrase(b, m);
        if (!choices.find(c => c.phonetic === choice.phonetic)) {
          choices.push(choice);
        }
      }

      shuffle(choices);
      symbolEl.textContent = answer.thai;
      symbolEl.setAttribute('aria-label', `Thai color phrase: ${answer.thai}`);
      symbolEl.style.color = answer.hex;

      choices.forEach(choice => {
        const btn = document.createElement('button');
        btn.textContent = choice.phonetic;
        btn.setAttribute('aria-label', `Answer: ${choice.phonetic}`);
        btn.onclick = () => {
          questionsAnswered++;
          if (choice.phonetic === answer.phonetic) {
            correctAnswers++;
            feedbackEl.textContent = "✅ Correct!";
            nextBtn.style.display = "inline-block";
          } else {
            feedbackEl.textContent = "❌ Try again!";
          }
          updateStats();
        };
        optionsEl.appendChild(btn);
      });
    }

    document.addEventListener('keydown', (e) => {
      if (/^[1-9]$/.test(e.key)) {
        const buttons = optionsEl.querySelectorAll('button');
        const index = parseInt(e.key, 10) - 1;
        if (buttons[index]) {
          buttons[index].click();
        }
      } else if (e.key === 'Enter' && nextBtn.style.display !== 'none') {
        nextBtn.click();
      }
    });

    nextBtn.onclick = pickQuestion;

    // Initialize
    pickQuestion();
    updateStats();
  </script>
</body>
</html>